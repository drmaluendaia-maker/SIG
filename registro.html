<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Pacientes - SIG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .triage-button.selected, .triage-button-modal.selected { transform: scale(1.05); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.5); }
        .dot-rojo { background-color: #ef4444; } .dot-naranja { background-color: #f97316; } .dot-amarillo { background-color: #f59e0b; }
        .dot-verde { background-color: #10b981; } .dot-azul { background-color: #3b82f6; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen">

    <div id="appContent" class="hidden opacity-0 transition-opacity duration-500 p-8">
        </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const socket = io();
            // --- DOM Elements (sin cambios) ---
            
            // --- App State (sin cambios) ---

            // --- Authentication (sin cambios) ---
            
            // --- Shift Management (sin cambios) ---

            // --- Rendering (sin cambios) ---

            // --- LISTENERS ---
            triageButtons.forEach(button => {
                button.addEventListener('click', () => {
                    triageButtons.forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    selectedLevel = button.dataset.level;
                });
            });

            triageForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (!patientNameInput.value.trim() || !selectedLevel) {
                    alert("Nombre y Nivel son obligatorios.");
                    return;
                }
                const presetText = observationSearch.value;
                const manualNotes = patientNotesInput.value.trim();
                const combinedNotes = [presetText, manualNotes].filter(Boolean).join('; ');

                const newPatient = {
                    // CORRECCIÃ“N: Se elimina el id: Date.now()
                    nombre: patientNameInput.value.trim().toUpperCase(),
                    dni: patientDniInput.value.trim(),
                    vitals: { 
                        tas: document.getElementById('vitalTas').value, tad: document.getElementById('vitalTad').value,
                        fc: document.getElementById('vitalFc').value, so2: document.getElementById('vitalSo2').value,
                        temp: document.getElementById('vitalTemp').value, hgt: document.getElementById('vitalHgt').value, 
                        edad: document.getElementById('vitalEdad').value 
                    },
                    notas: combinedNotes,
                    nivelTriage: selectedLevel,
                    ordenTriage: { 'rojo': 1, 'naranja': 2, 'amarillo': 3, 'verde': 4, 'azul': 5 }[selectedLevel],
                    horaLlegada: Date.now(),
                    registeredBy: currentUser.user
                };
                socket.emit('register_patient', newPatient);
                triageForm.reset();
                triageButtons.forEach(btn => btn.classList.remove('selected'));
                selectedLevel = null;
                patientNameInput.focus();
                observationSearch.value = '';
            });
            
            // ... (resto de listeners sin cambios) ...

            socket.on('update_patient_list', renderAllLists);
        });
    </script>
</body>
</html>
